<div class="checkin-page-container">
  @if (isScannerActive) {
    <app-check-in-scanner
      [enable]="isScannerActive"
      (scanResult)="onScanResult($event)"
      (permissionChange)="onPermissionChange($event)">
    </app-check-in-scanner>
  }
  <h1>Check-in do Evento por QRCode</h1>
  <p class="subtitle">Use os botões abaixo para controlar a câmera e ler os QRCodes dos participantes.</p>

  <div class="scanner-controls">
    @if (!isScannerActive) {
      <button class="btn btn-start" (click)="startScanner()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"></path><circle cx="12" cy="13" r="3"></circle></svg>
        Ativar Scanner
      </button>
    } @else {
      <button class="btn btn-stop" (click)="stopScanner()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="9" y1="9" x2="15" y2="15"></line><line x1="15" y1="9" x2="9" y2="15"></line></svg>
        Desativar Scanner
      </button>
    }
  </div>

  @if (hasCameraPermission === false && isScannerActive) {
    <div class="feedback-error permission-feedback">
      Você precisa permitir o acesso à câmera para fazer o check-in.
    </div>
  }

  @if (validationResult) {
    <div class="result-container" [ngClass]="validationResult.cssClass">
      <h2>{{ validationResult.message }}</h2>

      @if (validationResult.participantName) {
        <p>
          <strong>Participante:</strong> {{ validationResult.participantName }}
        </p>
      }

      @if (validationResult.eventName) {
        <p>
          <strong>Evento:</strong> {{ validationResult.eventName }}
        </p>
      }

      <button class="btn-rescan" (click)="startScanner()">Escanear Próximo</button>
    </div>
  }
</div>
